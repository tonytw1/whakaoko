#parse('includes/header.vm')
<div class="container">
    #parse('includes/heading.vm')
    <div class="row">
        <div class="container">
            <h5><a href="$urlBuilder.getUserUrl()">$user.username</a> /
            <a href="$urlBuilder.getChannelUrl($channel)">$channel.name</a> /
            #if($subscription.name)$subscription.name#else$subscription.url#end #if($totalCount > 0) ($totalCount) #end</h5>
        </div>
    </div>
    <div class="row">
        <div class="container">
            <code><a href="$subscription.url">$subscription.url</a></code>
            <p>
                <a href="$urlBuilder.getSubscriptionItemsUrl($subscription.id)/items">JSON</a> |
                <a href="$urlBuilder.getSubscriptionItemsUrl($subscription.id)/items?format=rss">RSS</a>
            </p>
            <p><a href="$urlBuilder.getDeleteSubscriptionUrl($subscription)">Delete</a></p>
            <p><a href="$urlBuilder.getReadSubscriptionUrl($subscription)">Read</a></p>

            #if($subscription.lastRead)
                <p><span title="$subscription.lastRead">Last read: $dateFormatter.timeSince($subscription.lastRead)</span></p>
            #end
            #if($subscription.latestItemDate)
                <p>Latest item date: $dateFormatter.timeSince($subscription.latestItemDate)</p>
            #end
            <p>ETag: $!subscription.etag</p>

            <p>
                Error: $!subscription.error<br/>
                Http status: $!subscription.httpStatus
            </p>
        </div>
    </div>

    <div class="row">
        <div class="container">
            #if(!$geotagged.isEmpty())
                <div class="row">
                    <div class="container">
                        #parse('includes/map.vm')
                        #foreach($feedItem in $geotagged)
                            <script>
                                var marker = L.marker([${feedItem.place.latLong.latitude}, ${feedItem.place.latLong.longitude}]).addTo(map).bindPopup("$feedItem.title");
                                markers.push(marker);
                            </script>
                        #end
                    </div>
                </div>
            #end

            #if($feedItems && !$feedItems.isEmpty())
                #foreach($feedItem in $feedItems)
                    <div class="row">
                        <div class="container">
                            #parse('includes/feeditem.vm')
                        </div>
                    </div>
                #end
            #else
                <p>No items from this subscription.</p>
            #end
        </div>
    </div>
</div>

<script>
    map.fitBounds(new L.featureGroup(markers).getBounds());
</script>
#parse('includes/footer.vm')
